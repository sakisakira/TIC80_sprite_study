# title:   grass quarter walk
# author:  SAkira <sakisakira@gmail.com>
# desc:    short description
# site:    website link
# license: MIT License (change this to your license of choice)
# version: 0.1
# script:  ruby

class Girl
	attr_reader(:last_x,:last_y,:direction)
	W_Base=256-256
	WSBase=262-256
	WNBase=320-256
	N_Base=268-256
	S_Base=332-256

	def initialize(base_id)
		@base_id=base_id
		@start_tic=0
		@last_x,@last_y=0,0
		@direction=[0,1]
	end

	def sprite_id(d_x,d_y)
		if d_x.zero? then
			return @base_id+N_Base if d_y<0
			return @base_id+S_Base if d_y>0
			return nil
		end
		return @base_id+WNBase if d_y<0
		return @base_id+W_Base if d_y==0
		return @base_id+WSBase if d_y>0
		return nil
	end

	def show(x,y,tic)
		d_x=(x-@last_x)<=>0
		d_y=(y-@last_y)<=>0
		if d_x==0 and d_y==0 then
			@start_tic=tic
		else
			@direction=[d_x,d_y]
		end
		d_t=(tic-@start_tic)/8%4
		d_t=1 if @start_tic==tic or d_t==3
		flip=if @direction[0]>0 or (@direction[0]==0 and d_t==2)
			then 1 else 0 end
		if d_x.zero? and d_y.zero? then
			sid=sprite_id(@direction[0],@direction[1])+2
		elsif d_x.zero? then
			sid=sprite_id(0,d_y)+d_t%2*2
		else
			sid=sprite_id(d_x,d_y)+d_t*2
		end
		vbank(1)
		spr(sid,x,y,0,1,flip,0,2,4)
		@last_x,@last_y=x,y
	end
end

$tic=0
$x=96
$y=24
$grass=Girl.new(256)
Width=240
Height=130

class GirlStatus
	attr_reader(:girl,:x,:y)
	def initialize(base_id)
		@girl=Girl.new(base_id)
		@x=rand(Width)
		@y=rand(Height)
		@dx=rand(3)-1
		@dy=rand(3)-1
		@duration=rand(60)
		@tic=0
	end

	def update
		@x+=@dx
		@y+=@dy
		@x=[[0,@x].max,Width].min
		@y=[[0,@y].max,Height].min
		if @tic>=@duration then
			@dx=rand(3)-1
			@dy=rand(3)-1
			@duration=rand(60)
			@tic=0
		end
		@tic+=1
	end
end

$girls=[]
30.times do |i|
	$girls << GirlStatus.new(256)
end

def TIC
	dir=0
	if btn(0) then # up
		$y-=1
	end
	if btn(1) then # down
		$y+=1
	end
	if btn(2) then # left
		$x-=1;dir=-1
	end
	if btn(3) then # right
		$x+=1;dir=1
	end

	vbank(0)
	cls(15)
	vbank(1)
	cls(0)
	$grass.show($x,$y,$tic)
	print("I'm Grass!",$x,$y+32,8)
	$girls.each do |gs|
		gs.update
		gs.girl.show(gs.x, gs.y,$tic)
	end
	$tic+=1
end


# <TILES>
# 001:eccccccccc888888caaaaaaaca888888cacccccccacc0ccccacc0ccccacc0ccc
# 002:ccccceee8888cceeaaaa0cee888a0ceeccca0ccc0cca0c0c0cca0c0c0cca0c0c
# 003:eccccccccc888888caaaaaaaca888888cacccccccacccccccacc0ccccacc0ccc
# 004:ccccceee8888cceeaaaa0cee888a0ceeccca0cccccca0c0c0cca0c0c0cca0c0c
# 017:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
# 018:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
# 019:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
# 020:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
# </TILES>

# <SPRITES>
# 000:0000000000000000000000320000003200000222000222220002222200222222
# 001:0000000000000000000000000000000022200000222200002222200022222000
# 002:0000000000000000000000320000003200000222000222220002222200222222
# 003:0000000000000000000000000000000022200000222200002222200022222000
# 004:0000000000000000000000320000003200000222000222220002222200222222
# 005:0000000000000000000000000000000022200000222200002222200022222000
# 006:0000000000000000000003000000030000000333000033220000322200022222
# 007:0000000000000000000000000000300033223000222332002223220022222220
# 008:0000000000000000000003000000030000000333000033220000322200022222
# 009:0000000000000000000000000000300033223000222332002223220022222220
# 010:0000000000000000000003000000030000000333000033220000322200022222
# 011:0000000000000000000000000000300033223000222332002223220022222220
# 012:0000000000000000002000000022200000022222000222220002222200322222
# 013:0000000000000000000002000003220033232000222220002222200022222300
# 014:0000000000000000002000000022200000022222000222220002222200322222
# 015:0000000000000000000002000003220033232000222220002222200022222300
# 016:00222522002d9dd30009add30047766300777773007667530007753200000222
# 017:2222200022222000222220002222200022222000222220002222200022222000
# 018:00222522002d9dd30009add30047766300777773007667530007753200000222
# 019:2222200022222000222220002222200022222000222220002222200022222000
# 020:00222522002d9dd30009add30047766300777773007667530007753200000222
# 021:2222200022222000222220002222200022222000222220002222200022222000
# 022:003222220032322200325223002f9d2700299ddf002677d90027777700327667
# 023:222222202222222022222220322222209d2222209dd222206662222077722220
# 024:003222220032322200325223002f9d2700299ddf002677d90027777700327667
# 025:222222202222222022222220322222209d2222209dd222206662222077722220
# 026:003222220032222200325222002f9d2700299ddf002677d90027777700327667
# 027:222222202222222022222220222222209d2222209dd222206662222077722220
# 028:0032222200022222000222220002222200022222000222220002222200022222
# 029:2222230022222300222222002222220022222200222222002222200022222000
# 030:0032222200322222003222220002222200022222000222220002222200022222
# 031:2222230022222300222222002222200022222000222220002222200022222000
# 032:000022dd00006ddd00066ddd00066ddd0000aad6000ddadd00bbbadd0075aadd
# 033:2222200022220000dd220000ddda00006ddd00006ddd000066db0000dbbbb000
# 034:000022dd00006ddd00066d6d00066d6d0000dd6d0000dd6d0000ad6d0000adbb
# 035:2222200022220000d2220000d6d00000d6d00000d6d00000d6d00000bbd00000
# 036:000022dd00006ddd00066ddd00066dd60000ddd6000bbd66000bbb6d000755bd
# 037:2222200022220000d2220000ddd00000ddd00000ddd00000dddd0000dddd0000
# 038:00ddd77700dddb5500dddb220dd6dbbb0dd6dabb0dd6daaa0bbbddaa075ddaaa
# 039:77322d20b6ddddd0b6ddddddbdddd6ddbdddd6ddbdddd6ddaadddbbbaaddd077
# 040:00dd677700d66b5500d6db2200dddbbb005dddbb007dddaa007dddaa000dddaa
# 041:77322d20b6ddddd0b6dddd60bdd6dd60bdd6dd60bdd6dd60addddd60aaddbbb0
# 042:00dd677700d66b5500d6db2200dddbbb00dddabb0007daaa000ddaaa00ddaaaa
# 043:77322d20bdddddd0bddd6dd0bdd66dd0bdd6ddd0bdd6dd00add6dd00addbbb00
# 044:00dd22220ddd22220ddddddd00dddddd0bdddddd0bbbdddd0000dddd000ddddd
# 045:2222dd002222ddd0ddddddd0dddddd00dddddd00ddddddb0ddddbbb0dddd7700
# 046:000d222200dd222200dddddd00dddddd00dddddd00dd0ddd0bbbdddd0bbbdddd
# 047:2222d0002222dd00dddddd00dddddd00dddddd00ddd0dd00ddddbbb0ddddbbb0
# 048:0077aaad0000075d0000075d0000775000337750000337700000222000000000
# 049:db577000dd770000dddd00005550000007750000053220000222000000000000
# 050:000aad75000aad7700000ddd0000007500000077000000770000032200000000
# 051:55dd00007ddd0000dddd00005000000050000000500000002000000000000000
# 052:00077aad0000aaad000007550000075500337750000337500000222000000000
# 053:dddd0000dddd00005ddd00007750000007550000053220000222000000000000
# 054:055ddaaa0000d555000000550000005500000322000000000000000000000000
# 055:aaddd077aaddd00055ddd0007770000077700000777000007770000032200000
# 056:000ddaaa000dd55a000077500000777000007770000032200000000000000000
# 057:adddd770adddd0000dddd0000555000007770000077700000322000000000000
# 058:00dddaaa00ddd500000775000007750000077700000772000033220000000000
# 059:aad7700055ddd000055500000777000003220000000000000000000000000000
# 060:000ddddd000ddddd000ddddd0000dddd00007750000077500000775000003220
# 061:ddddd000ddddd000ddddd000d577000005770000032200000000000000000000
# 062:007ddddd000ddddd000ddddd000077dd00007750000077500000322000000000
# 063:ddddd700ddddd000ddddd000dd77000005770000057700000322000000000000
# 064:0000000000000000000003000000030300000222000032220003222200322222
# 065:0000000000003000000030002222200022222200222222002222222022222220
# 066:0000000000000000000003000000030300000222000032220003222200322222
# 067:0000000000003000000030002222200022222200222222002222222022222220
# 068:0000000000000000000003000000030300000222000032220003222200322222
# 069:0000000000003000000030002222200022222200222222002222222022222220
# 076:0000000000000000002200000002203200022222000222220032222200322322
# 077:0000000000000000000022002203200022222000222220002222220023222200
# 078:0000000000000000002200000002203200022222000222220032222200322322
# 079:0000000000000000000022002202200022222000222220002222220023222200
# 080:00333322000553220009d3220009dd3200076632000777320006733200007322
# 081:2222222022222220222222202222222022222220222222202222220022222200
# 082:00333322000553220009d3220009dd3200076632000777320006733200007322
# 083:2222222022222220222222202222222022222220222222202222220022222200
# 084:00333322000553220009d3220009dd3200076632000777320006733200007322
# 085:2222222022222220222222202222222022222220222222202222220022222200
# 092:003225520032df9d0022d99d00226677000277770032577603222577032d22b5
# 093:255222002f9d2200299d2200776622007777200067752200775222205b22d220
# 094:003225520032df9d0032d99d00326677000277770002577603222577032d22b5
# 095:255222002f9d2200299d2200776622007777200067752000775222205b22d220
# 096:000002220000022200ddd22200dddd220dd6dddd0dd6ddddbbbb6ddd05556ddd
# 097:222220002222200022222d0022ddddd0dddd6dd0dddd6dd0dddd6bb0dddd6550
# 098:000002220000022200066222006ddd22006ddddd006d6ddd00dd6ddd0bbb6ddd
# 099:222220002222200022222d0022ddddd0ddddddd0ddddddd0dddddbb0ddddd550
# 100:000002220000022200066222006ddd22006ddddd006dd6dd00ddd6dd000dd6dd
# 101:222220002222200022222d0022dddd00dddddd00ddddd000ddddd000ddddd000
# 108:032dddb200dd6dbb00dd66bb00ddd6bb00ddd6bb000dbbaa00dbb7aa00da77aa
# 109:2bddd220bbdddd00bbdd6d00bbdd6d00bbdd6d00aaadbb00aaadd700aaaad000
# 110:032dddb200ddddbb0dd6ddbb0dd6ddbb00d6ddbb0bbbddaa0bbbdaaa007ddaaa
# 111:2bddd220bbdddd00bbdd6dd0bbdd6dd0bbdd6d00aaadbbb0aaadbbb0aaadd700
# 112:0775dddd0006dddd0000dddd0000dddd00000777000000770000003200000000
# 113:dddd6000dddd0000dddd00005550000052200000700000002000000000000000
# 114:00556ddd00776ddd0000dddd0000055500000775000007750000032200000000
# 115:ddddd700ddddd000dd5500000775000007750000032200000000000000000000
# 116:000bbbdd000055dd000077dd0000555000037750000322200000000000000000
# 117:dddddd00dddddd00dddddd000055500000775000007750000032200000000000
# 124:00dd555d0000222d0000222000002220000022200000ddd00000000000000000
# 125:aaaad000d555d00002220000022200000222000002220000022200000ddd0000
# 126:000daaaa000d555d000022200000222000002220000022200000ddd000000000
# 127:aaaad000d555d000022200000222000002220000022200000ddd000000000000
# </SPRITES>

# <WAVES>
# 000:00000000ffffffff00000000ffffffff
# 001:0123456789abcdeffedcba9876543210
# 002:0123456789abcdef0123456789abcdef
# </WAVES>

# <SFX>
# 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
# </SFX>

# <TRACKS>
# 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
# </TRACKS>

# <PALETTE>
# 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
# 001:000000604e618a5655af7569ba8c6fdfb089f3a6b2f6c7c3fdeae07395c05a2fd8f08c27f6b95bff4200ffffffcfd8ff
# </PALETTE>

